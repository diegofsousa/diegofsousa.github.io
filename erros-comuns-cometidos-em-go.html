<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Erros comuns cometidos em Go - Parte I</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://diegofernando.dev/erros-comuns-cometidos-em-go.html" rel="canonical" />
  <!-- Feed -->

  <link href="https://diegofernando.dev/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="https://diegofernando.dev/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Go √© uma linguagem marcada pela sua excentricidade, seja pelo foco em performance ou pela experi√™ncia √∫nica de desenvolvimento. Esse...">

    <meta name="author" content="diego">

    <meta name="tags" content="golang">
    <meta name="tags" content="backend">
    <meta name="tags" content="programa√ß√£o">




<!-- Open Graph -->
<meta property="og:site_name" content="Diego Fernando"/>
<meta property="og:title" content="Erros comuns cometidos em Go - Parte I"/>
<meta property="og:description" content="Go √© uma linguagem marcada pela sua excentricidade, seja pelo foco em performance ou pela experi√™ncia √∫nica de desenvolvimento. Esse..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://diegofernando.dev/erros-comuns-cometidos-em-go.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2025-04-25 17:44:00-03:00"/>
<meta property="article:modified_time" content="2025-04-26 16:49:41.599482-03:00"/>
<meta property="article:author" content="https://diegofernando.dev/author/diego">
  <meta property="article:publisher" content="http://facebook.com/arulraj.net" />
<meta property="article:section" content="misc"/>
<meta property="article:tag" content="golang"/>
<meta property="article:tag" content="backend"/>
<meta property="article:tag" content="programa√ß√£o"/>
<meta property="og:image" content="https://diegofernando.dev/assets/images/common-errors.jpeg">

<!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@arulrajnet">
    <meta name="twitter:title" content="Erros comuns cometidos em Go - Parte I">
    <meta name="twitter:url" content="https://diegofernando.dev/erros-comuns-cometidos-em-go.html">

        <meta name="twitter:image:src" content="https://diegofernando.dev/assets/images/common-errors.jpeg">

      <meta name="twitter:description" content="Go √© uma linguagem marcada pela sua excentricidade, seja pelo foco em performance ou pela experi√™ncia √∫nica de desenvolvimento. Esse...">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Erros comuns cometidos em Go - Parte I",
  "headline": "Erros comuns cometidos em Go - Parte I",
  "datePublished": "2025-04-25 17:44:00-03:00",
  "dateModified": "2025-04-26 16:49:41.599482-03:00",
  "author": {
    "@type": "Person",
    "name": "diego",
    "url": "https://diegofernando.dev/author/diego"
  },
  "image": "https://diegofernando.dev/assets/images/common-errors.jpeg",
  "url": "https://diegofernando.dev/erros-comuns-cometidos-em-go.html",
  "description": "Go √© uma linguagem marcada pela sua excentricidade, seja pelo foco em performance ou pela experi√™ncia √∫nica de desenvolvimento. Esse..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

              <li role="presentation"><a href="https://diegofernando.dev/pages/about/">About</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://diegofernando.dev/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Erros comuns cometidos em Go - Parte I</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="https://diegofernando.dev/author/diego">Diego Fernando</a>
            | <time datetime="25 abr 2025">25 abr 2025</time>
        </span>
        <!-- TODO : Modified check -->
            <span class="post-meta"> | Updated on 26 abr 2025</span>
            <div class="post-cover cover" style="background-image: url('https://diegofernando.dev/assets/images/common-errors.jpeg')">
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p><strong>Go</strong> √© uma linguagem marcada pela sua excentricidade, seja pelo foco em performance ou pela experi√™ncia √∫nica de desenvolvimento. Esse perfil faz com que muitos desenvolvedores, cometam alguns deslizes. Equ√≠vocos podem acontecer tanto com iniciantes quanto com profissionais mais experientes. Inclusive, por experi√™ncia pr√≥pria, j√° me peguei utilizando tra√ßos de outra linguagem ao programar em Go.</p>
<p>Neste artigo, apresento <strong>5 erros comuns</strong> cometidos por quem est√° se aventurando na linguagem. Alguns dos pontos listados refletem situa√ß√µes que presencio no dia a dia. Al√©m disso, fiz uma pesquisa para identificar outros cen√°rios recorrentes. Essa √© uma lista curada que pode fazer sentido principalmente para <em>gophers</em> de primeira viagem. Ent√£o vamos √† lista:</p>
<h1>#1: Passando valores em vez de ponteiros</h1>
<p>Neste caso, n√£o se trata necessariamente de um erro. Na verdade, n√£o h√° qualquer problema em passar valores diretamente, especialmente para tipos pequenos como <code>int</code>, <code>string</code> e <code>bool</code>. Por√©m, essa escolha faz diferen√ßa quando lidamos com tipos maiores, como uma struct que cont√©m v√°rios arrays.</p>
<p>Sempre que criamos uma fun√ß√£o ou m√©todo que recebe um argumento por valor, o Go <strong>cria uma c√≥pia</strong> do elemento dentro do escopo da fun√ß√£o. Para ilustrar isso, vamos fazer um experimento: criaremos uma vari√°vel chamada <code>name</code> e uma fun√ß√£o <code>showName</code>, na qual essa vari√°vel ser√° passada por valor:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">:=</span> <span class="s2">&quot;test&quot;</span>

    <span class="n">showName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">showName</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>Apesar de ser uma pr√°tica bastante comum, √© importante entender exatamente o que est√° acontecendo. A execu√ß√£o do m√©todo <code>showName</code> implica na reserva de um novo espa√ßo de mem√≥ria para armazenar a c√≥pia de <code>name</code>. Podemos fazer um pequena modifica√ß√£o no c√≥digo para ilustrar:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">:=</span> <span class="s2">&quot;test&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>

    <span class="n">showName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">showName</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>Nesta nova vers√£o, imprimimos tanto o valor de <code>name</code> quanto seu endere√ßo de mem√≥ria no m√©todo <code>main</code> e dentro de <code>showName</code>. A sa√≠da ser√°:</p>
<div class="highlight"><pre><span></span><code><span class="mf">0</span><span class="n">xc000120040</span><span class="w"></span>
<span class="mf">0</span><span class="n">xc000120050</span><span class="w"></span>
<span class="n">test</span><span class="w"></span>

<span class="n">Program</span><span class="w"> </span><span class="n">exited</span><span class="mf">.</span><span class="w"></span>
</code></pre></div>

<p>Os endere√ßos <code>0xc000120040</code> e <code>0xc000120050</code> representam locais diferentes na mem√≥ria. Isso evidencia que <code>name</code> foi copiado, ou seja: dentro de <code>showName</code> estamos trabalhando com uma nova inst√¢ncia, independente da original.</p>
<h2>Passando o valor de <code>name</code> x Passando o ponteiro de <code>name</code></h2>
<p>Em Go, geralmente sempre passamos valores. Por√©m, quando queremos manipular o mesmo espa√ßo de mem√≥ria, enviamos um como valor um ponteiro, que aponta para o dado original.</p>
<p>Com esse conceito em mente, conseguimos entender como funciona a passagem de par√¢metros como <strong>valor</strong> e como <strong>ponteiro</strong>. Quando usamos a passagem por <strong>valor</strong>, a fun√ß√£o <code>showName</code> recebe apenas o conte√∫do de <code>name</code>. Agora, vejamos um exemplo de passagem por <strong>ponteiro</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">:=</span> <span class="s2">&quot;test&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>

    <span class="n">showName</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">showName</span><span class="p">(</span><span class="n">name</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>Modificamos o c√≥digo anterior. Ao inv√©s de passar o conte√∫do de <code>name</code> para <code>showName</code>, enviamos seu endere√ßo de mem√≥ria. Com isso, tamb√©m alteramos a defini√ß√£o da fun√ß√£o: agora ela recebe um ponteiro de <code>string</code> (<code>*string</code>), em vez de uma <code>string</code> simples.</p>
<p>A forma de exibir o valor e o endere√ßo de mem√≥ria muda: para acessar o conte√∫do, precisamos <strong>desreferenciar</strong> (ou <em>dereferenciar</em>) o ponteiro usando <code>*name</code>. A sa√≠da ser√°:</p>
<div class="highlight"><pre><span></span><code><span class="mf">0</span><span class="n">xc0000a8040</span><span class="w"></span>
<span class="mf">0</span><span class="n">xc0000a8040</span><span class="w"></span>
<span class="n">test</span><span class="w"></span>

<span class="n">Program</span><span class="w"> </span><span class="n">exited</span><span class="mf">.</span><span class="w"></span>
</code></pre></div>

<p>Agora estamos manipulando <code>name</code> diretamente no mesmo endere√ßo de mem√≥ria. Um ponto interessante √© que, se alterarmos o valor de <code>name</code> dentro da fun√ß√£o <code>showName</code>, a vari√°vel original, definida no m√©todo <code>main</code>, tamb√©m ser√° alterada  (justamente porque ambas compartilham o mesmo espa√ßo de mem√≥ria).</p>
<h1>#2: Acreditar cegamente em ponteiros</h1>
<p>Vamos a um caso cl√°ssico: declara√ß√£o de um ponteiro e uso imediato. Quando trabalhamos com ponteiros, o ideal √© <strong>verificar se eles n√£o est√£o nulos</strong> antes de acess√°-los. Uma situa√ß√£o de erro seria:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">test</span> <span class="o">*</span><span class="nb">int</span>

    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">test</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>A sa√≠da para este c√≥digo √©:</p>
<div class="highlight"><pre><span></span><code><span class="nl">panic</span><span class="p">:</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="nb">nil</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"></span>
<span class="p">[</span><span class="n">signal</span><span class="w"> </span><span class="n">SIGSEGV</span><span class="o">:</span><span class="w"> </span><span class="n">segmentation</span><span class="w"> </span><span class="n">violation</span><span class="w"> </span><span class="n">code</span><span class="o">=</span><span class="mh">0x1</span><span class="w"> </span><span class="n">addr</span><span class="o">=</span><span class="mh">0x0</span><span class="w"> </span><span class="n">pc</span><span class="o">=</span><span class="mh">0x491476</span><span class="p">]</span><span class="w"></span>

<span class="n">goroutine</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="n">running</span><span class="p">]</span><span class="o">:</span><span class="w"></span>
<span class="n">main</span><span class="p">.</span><span class="n">main</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox2767359061</span><span class="o">/</span><span class="n">prog</span><span class="p">.</span><span class="n">go</span><span class="o">:</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mh">0x16</span><span class="w"></span>
</code></pre></div>

<p>Ao tentarmos imprimir o valor de <code>test</code> por meio da desreferencia√ß√£o, ocorre um erro. Isso acontece porque o ponteiro n√£o foi inicializado e, por padr√£o, √© <code>nil</code>. A minha dica aqui √©: <strong>por padr√£o, nunca acredite em ponteiros</strong>. Para este caso, uma verifica√ß√£o b√°sica j√° evita o erro:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">test</span> <span class="o">*</span><span class="nb">int</span>

    <span class="k">if</span> <span class="n">test</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">test</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h1>#3: Ignorar erros</h1>
<p>Quando lidamos com m√©todos e fun√ß√µes, normalmente nos deparamos com o seguinte cen√°rio:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">doSomething</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">test</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">do</span> <span class="n">sometring</span>
    <span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;some error&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>√â muito tentador ignorar o tratamento de erros em Go, especialmente devido √† sua verbosidade. Por√©m, n√£o fazer o tratamento adequado √©, de longe, a <strong>pior</strong> coisa que podemos fazer. No c√≥digo acima, por consequ√™ncia, iremos esbarrar no mesmo erro j√° visto anteriormente:</p>
<div class="highlight"><pre><span></span><code><span class="nl">panic</span><span class="p">:</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="nb">nil</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"></span>
<span class="p">[</span><span class="n">signal</span><span class="w"> </span><span class="n">SIGSEGV</span><span class="o">:</span><span class="w"> </span><span class="n">segmentation</span><span class="w"> </span><span class="n">violation</span><span class="w"> </span><span class="n">code</span><span class="o">=</span><span class="mh">0x1</span><span class="w"> </span><span class="n">addr</span><span class="o">=</span><span class="mh">0x0</span><span class="w"> </span><span class="n">pc</span><span class="o">=</span><span class="mh">0x49438f</span><span class="p">]</span><span class="w"></span>

<span class="n">goroutine</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="n">running</span><span class="p">]</span><span class="o">:</span><span class="w"></span>
<span class="n">main</span><span class="p">.</span><span class="n">main</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sandbox2271710943</span><span class="o">/</span><span class="n">prog</span><span class="p">.</span><span class="n">go</span><span class="o">:</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mh">0x2f</span><span class="w"></span>

<span class="n">Program</span><span class="w"> </span><span class="n">exited</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<p>Em Go, √© comum que fun√ß√µes e m√©todos retornem um erro para sinalizar situa√ß√µes inesperadas. Por isso, sempre devemos considerar a possibilidade de falhas e tratar esses erros adequadamente para manter o fluxo da aplica√ß√£o seguro. No caso acima, podemos evitar a falha criando um tratamento simples:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">doSomething</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="o">//</span> <span class="n">add</span> <span class="n">handling</span> <span class="n">error</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">test</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">do</span> <span class="n">sometring</span>
    <span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;some error&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>Assim, garantimos que o programa n√£o sofra interrup√ß√µes inesperadas.</p>
<h1>#4: Supergeneralizar erros</h1>
<p>Existe um <a href="https://go.dev/blog/errors-are-values">discurso bem famoso feito pelo pr√≥prio Rob Pike sobre erros</a>, chamado <strong><em>"Errors are values"</em></strong>. Isso endossa bem a filosofia da linguagem e nos convida a refletir sobre vis√£o tradicional deste tema.</p>
<blockquote>
<p>‚Äú<strong><em>Whatever you do, always check your errors!. -Rob Pike</em></strong>‚Äù. </p>
</blockquote>
<p>Vamos entender esse ponto com um caso de uso de um sistema que realiza chamadas a um banco de dados:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">Person</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">name</span> <span class="n">string</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">person</span> <span class="n">Person</span><span class="p">)</span> <span class="n">validate</span><span class="p">()</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;person with no name&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">p</span> <span class="o">:=</span> <span class="n">Person</span><span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;diego&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">err</span> <span class="o">:=</span> <span class="n">createPerson</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="n">func</span> <span class="n">createPerson</span><span class="p">(</span><span class="n">person</span> <span class="o">*</span><span class="n">Person</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>

    <span class="o">//</span> <span class="n">validate</span> <span class="n">person</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">person</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;db insert error&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">get</span> <span class="n">db</span> <span class="n">instance</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">GetDB</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;db insert error&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">db</span> <span class="n">commit</span> <span class="n">data</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;db insert error&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>

<p>Supondo que todas as camadas estejam bem implementadas, esse c√≥digo tende a funcionar. Mas o problema excede o fato de funcionar ou n√£o. A d√∫vida impl√≠cita neste c√≥digo √©: <em>como sabemos o que </em><em>de fato</em><em> aconteceu em um erro <code>db insert error</code>?</em> Um erro gen√©rico como esse pode ter v√°rias causas diferentes. Podemos melhorar o tratamento assim:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">validate</span><span class="w"> </span><span class="nv">person</span><span class="w"></span>
<span class="w">    </span><span class="nv">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nv">person</span><span class="o">.</span><span class="nf">validate</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nv">return</span><span class="w"> </span><span class="nv">err</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">db</span><span class="w"> </span><span class="nv">instance</span><span class="w"></span>
<span class="w">    </span><span class="nv">db</span><span class="p">,</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">GetDB</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nv">return</span><span class="w"> </span><span class="nv">fmt</span><span class="o">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&quot;get instance db error&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">db</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="nv">data</span><span class="w"></span>
<span class="w">    </span><span class="nv">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nv">db</span><span class="o">.</span><span class="nf">Commit</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nv">return</span><span class="w"> </span><span class="nv">fmt</span><span class="o">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&quot;db commit error&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nv">return</span><span class="w"> </span><span class="nv">nil</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</code></pre></div>

<p>Essa pequena mudan√ßa j√° traz um panorama muito mais claro sobre o que de fato ocorreu. Uma sugest√£o adicional para melhorar ainda mais a tratativa de erros √© <strong>implementar a interface de erro do Go</strong>, criando erros personalizados e enriquecendo as mensagens de retorno. Veremos isso no pr√≥ximo t√≥pico.</p>
<h2>Criando tipos de erros personalizados atrav√©s da interface <code>error</code></h2>
<p>No Go, qualquer tipo que implemente a seguinte interface √© considerado um erro:</p>
<div class="highlight"><pre><span></span><code>type error interface {
    Error() string
}
</code></pre></div>

<p>Quando sobrescrevemos essa interface, temos a possibilidade de criar tipos de erros personalizados. Isso traz muito mais <strong>flexibilidade</strong>, pois n√£o ficamos mais limitados a usar apenas uma string para identificar o erro. Veja o exemplo abaixo:</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
<span class="p">)</span>


<span class="nb">type</span> <span class="n">Person</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">name</span> <span class="n">string</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">CreatePersonError</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Op</span>  <span class="n">string</span> <span class="o">//</span> <span class="n">failed</span> <span class="n">operation</span> <span class="p">(</span><span class="n">ex</span><span class="p">:</span> <span class="s2">&quot;get_db_instance&quot;</span><span class="p">,</span> <span class="s2">&quot;db_commit&quot;</span><span class="p">)</span>
    <span class="n">Err</span> <span class="n">error</span>  <span class="o">//</span> <span class="n">original</span> <span class="n">error</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span><span class="n">CreatePersonError</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;create person failed at </span><span class="si">%s</span><span class="s2">: %v&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">Op</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">Err</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">person</span> <span class="n">Person</span><span class="p">)</span> <span class="n">validate</span><span class="p">()</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;person with no name&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">p</span> <span class="o">:=</span> <span class="n">Person</span><span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;diego&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">err</span> <span class="o">:=</span> <span class="n">createPerson</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="n">func</span> <span class="n">createPerson</span><span class="p">(</span><span class="n">person</span> <span class="o">*</span><span class="n">Person</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">person</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">get</span> <span class="n">db</span> <span class="n">instance</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">GetDB</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&amp;</span><span class="n">CreatePersonError</span><span class="p">{</span>
            <span class="n">Op</span><span class="p">:</span>  <span class="s2">&quot;get_db_instance&quot;</span><span class="p">,</span>
            <span class="n">Err</span><span class="p">:</span> <span class="n">err</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">db</span> <span class="n">commit</span> <span class="n">data</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&amp;</span><span class="n">CreatePersonError</span><span class="p">{</span>
            <span class="n">Op</span><span class="p">:</span>  <span class="s2">&quot;db_commit&quot;</span><span class="p">,</span>
            <span class="n">Err</span><span class="p">:</span> <span class="n">err</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>

<p>Criamos um novo tipo chamado <code>CreatePersonError</code> e implementamos o m√©todo <code>Error()</code> para ele.
Assim, capturamos o erro original e conseguimos adicionar informa√ß√µes importantes, como a opera√ß√£o que falhou. Todas essas melhorias facilitam um poss√≠vel <em>troubleshooting</em> em cen√°rios de falhas.</p>
<h1>#5: Registrar erros com <code>log.Fatal()</code></h1>
<p>Quando nosso sistema encontra um erro irrecuper√°vel, registrar o erro com <code>log.Fatal()</code> pode parecer uma solu√ß√£o conveniente, j√° que ele registra a mensagem e encerra o processo imediatamente. Por√©m, o que muitas vezes passa despercebido √© que <code>log.Fatal()</code> internamente faz uma chamada a <code>os.Exit()</code>.
Isso √© <strong>problem√°tico</strong> porque impede a execu√ß√£o de qualquer outra rotina de limpeza ou encerramento, como <code>defer</code>'s ou fechamento de conex√µes.</p>
<p>Por isso, a abordagem recomendada √© sempre retornar o erro para o n√≠vel superior da aplica√ß√£o, onde ele possa ser tratado adequadamente. Normalmente, o √∫nico local onde o uso de <code>log.Fatal()</code> √© considerado aceit√°vel √© dentro da fun√ß√£o <code>main()</code>, onde faz sentido finalizar a execu√ß√£o do programa de maneira controlada.</p>
<h1>Considera√ß√µes finais</h1>
<p>Existem muitas outras situa√ß√µes que poderiam ser listadas aqui (<strong>inclusive, me conta nos coment√°rios quais voc√™ adicionaria!</strong> üòä).
O Go √© uma linguagem que tem padr√µes bem estabelecidos e formas claras de construir solu√ß√µes. E √© completamente normal a gente trope√ßar de vez em quando, √†s vezes por descuido, por falta de aten√ß√£o ou simplesmente pela correria do dia a dia (<em>afinal, todos temos prazos, n√©?</em>).</p>
<p>Neste post, quis compartilhar algumas situa√ß√µes que j√° vi acontecer (algumas vividas na pele) errando, aprendendo e, claro, criando alguns bugs no caminho. A ideia foi trazer um pouco dessas experi√™ncias e boas pr√°ticas que fazem parte do ecossistema Go.</p>
<p>Minha inten√ß√£o √© transformar esse post em uma s√©rie, ent√£o fica por aqui e vamos seguir aprendendo juntos.</p>
<p>At√© a pr√≥xima :)</p>
<h4>Refer√™ncias</h4>
<ul>
<li><a href="https://www.jetbrains.com/guide/go/tutorials/handle_errors_in_go/common_mistakes/">https://www.jetbrains.com/guide/go/tutorials/handle_errors_in_go/common_mistakes/</a></li>
<li><a href="https://medium.com/@sebdah/go-best-practices-error-handling-2d15e1f0c5ee">https://medium.com/@sebdah/go-best-practices-error-handling-2d15e1f0c5ee</a></li>
<li><a href="https://earthly.dev/blog/learning-golang-common-mistakes-to-avoid/">https://earthly.dev/blog/learning-golang-common-mistakes-to-avoid/</a></li>
<li><a href="https://weilson.medium.com/top-5-most-common-mistakes-in-golang-56be1be9d676">https://weilson.medium.com/top-5-most-common-mistakes-in-golang-56be1be9d676</a></li>
<li><a href="https://go.dev/blog/errors-are-values">https://go.dev/blog/errors-are-values</a></li>
</ul>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Erros comuns cometidos em Go - Parte I&amp;url=https://diegofernando.dev/erros-comuns-cometidos-em-go.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://diegofernando.dev/erros-comuns-cometidos-em-go.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://diegofernando.dev/tag/golang">golang</a><a href="https://diegofernando.dev/tag/backend">backend</a><a href="https://diegofernando.dev/tag/programacao">programa√ß√£o</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">


                        <figure class="post-author-avatar">
                            <img src="https://diegofernando.dev/assets/images/eu-df.jpeg" alt="Diego Fernando" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="https://diegofernando.dev/author/diego">Diego Fernando</a></h4>
                            <p class="post-author-about">Software Engineer. Enthusiast of distributed systems, programming languages and Brazilian music. Proudly born and raised in northeastern Brazil ‚ù§Ô∏è.</p>
                            <span class="post-author-location"><i class="ic ic-location"></i> Brazil</span>
                            <span class="post-author-website"><a href="https://diegofernando.dev"><i class="ic ic-link"></i> Website</a></span>
                        <!-- Social linkes in alphabet order. -->
                            <span class="post-author-github"><a target="_blank" href="https://github.com/diegofsousa"><i class="ic ic-link"></i> GitHub</a></span>
                            <span class="post-author-linkedin"><a target="_blank" href="https://www.linkedin.com/in/diegofsousa"><i class="ic ic-link"></i> LinkedIn</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>

                <script type="text/javascript">
                    var disqus = 'diegofsousa';
                    var disqus_shortname = 'diegofsousa';
                    var disqus_identifier = '/erros-comuns-cometidos-em-go.html';
                    var disqus_url = 'https://diegofernando.dev/erros-comuns-cometidos-em-go.html';
                </script>
                <noscript>Please enable JavaScript to view the comments.</noscript>
                <section class="post-comments">
                        <a id="show-disqus" class="post-comments-activate" data-disqus-identifier="/erros-comuns-cometidos-em-go.html" >Show Comments</a>
                    <div id="disqus_thread"></div>
                </section>

                <aside class="post-nav">
                    <a class="post-nav-prev" href="https://diegofernando.dev/o-go-nao-foi-feito-pra-ser-bonito.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">O Go n√£o foi feito pra ser bonito... e isso n√£o deveria ser um problema.</h2>
                            <p class="post-nav-excerpt">√â isso mesmo que voc√™ leu: o Go n√£o foi feito para ser bonito Essa frase, apesar de...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://diegofernando.dev/theme/js/script.js"></script>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178470984-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-178470984-1', { 'anonymize_ip': true });
    </script>
<script type="text/javascript">
    var disqus_shortname = 'diegofsousa';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>